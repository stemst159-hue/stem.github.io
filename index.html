<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stem kit controller</title>
</head>
<body>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Stemkits cotroller</title>
    <style>
        /* --- Global Variables and Resets --- */
        :root {
            --color-primary: #00bcd4; /* Cyan/Aqua - Professional Tech Look */
            --color-secondary: #ff9800; /* Orange/Amber for Warnings/Highlights */
            --color-danger: #e53935; /* Red for Emergency Stop */
            --color-success: #4caf50; /* Green for Connection Status */
            
            /* Dark Mode (Default) */
            --color-text-dark: #e0e0e0;
            --color-bg-dark: #1e1e1e;
            --color-card-dark: #2a2a2a;
            --color-border-dark: #3a3a3a;
            
            /* Light Mode */
            --color-text-light: #333;
            --color-bg-light: #f4f7f9;
            --color-card-light: #ffffff;
            --color-border-light: #e0e0e0;

            --transition-speed: 0.3s;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Base theme switching */
        .dark-mode {
            --color-text: var(--color-text-dark);
            --color-background: var(--color-bg-dark);
            --color-card: var(--color-card-dark);
            --color-border: var(--color-border-dark);
        }

        .light-mode {
            --color-text: var(--color-text-light);
            --color-background: var(--color-bg-light);
            --color-card: var(--color-card-light);
            --color-border: var(--color-border-light);
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color var(--transition-speed), color var(--transition-speed), border-color var(--transition-speed), box-shadow var(--transition-speed);
        }

        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--color-background);
            color: var(--color-text);
            line-height: 1.6;
        }

        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Header & Navigation --- */
        header {
            background-color: var(--color-card);
            border-bottom: 1px solid var(--color-primary);
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.8em;
            font-weight: 900;
            color: var(--color-primary);
            letter-spacing: 2px;
        }

        nav ul {
            list-style: none;
            display: flex;
        }

        nav ul li a {
            color: var(--color-text);
            text-decoration: none;
            padding: 10px 15px;
            margin: 0 5px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
        }

        nav ul li a:hover {
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        /* --- Hero/3D Section (Stylish Stems) --- */
        .hero-3d {
            height: 70vh; 
            background-color: var(--color-bg-dark); 
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            /* Aesthetic "stems" background effect using subtle repeated lines */
            background-image: radial-gradient(circle at center, rgba(255, 4, 4, 0.1), rgba(11, 1, 1, 0.8)),
                              repeating-linear-gradient(0deg, #6d6969 0, #3a3a3a 1px, #561a1a 2px);
            border-bottom: 3px solid var(--color-primary);
        }

        #threejs-container {
            width: 100%;
            height: 100%;
            color: white;
            text-align: center;
            padding-top: 15%; 
        }

        h1 {
            font-size: 4em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
        }

        /* --- General Tool Section Styling --- */
        .tool-section {
            padding: 40px 0;
        }

        .section-divider {
            border: none;
            height: 1px;
            background-color: var(--color-border);
            margin: 20px 0;
        }

        .section-divider-small {
            border: none;
            height: 1px;
            background-color: var(--color-border);
            margin: 15px 0;
        }

        h2 {
            font-size: 2.5em;
            color: var(--color-primary);
            margin-bottom: 25px;
            border-left: 6px solid var(--color-primary);
            padding-left: 15px;
            font-weight: 300;
        }

        .tool-content {
            background-color: var(--color-card);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--box-shadow);
        }

        /* Button Base Styles */
        button {
            border: none;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* --- Connect Tool Styling --- */
        .connection-status {
            text-align: center;
            margin-bottom: 20px;
        }

        #connection-state {
            font-size: 1.5em;
            font-weight: 700;
            padding: 10px 20px;
            border-radius: 5px;
            color: var(--color-bg-dark);
            display: inline-block; /* Added for proper padding and background */
        }

        .disconnected {
            background-color: var(--color-danger);
            animation: blink-red 2s infinite;
        }

        .connected {
            background-color: var(--color-success);
            animation: none;
        }

        @keyframes blink-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .connection-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .connect-btn {
            flex-grow: 1;
            color: white;
            background-color: var(--color-secondary); /* Bluetooth color */
        }

        .connect-btn:hover {
            background-color: #d17500;
        }

        .danger-btn {
            background-color: #616161; /* Disconnect button (greyed out when disabled) */
            color: white;
        }

        .danger-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .bluetooth-note {
            font-size: 0.9em;
            opacity: 0.7;
            margin-top: 10px;
        }

        /* --- Video Placeholder --- */
        .video-placeholder {
            background-color: #000;
            height: 450px;
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.5em;
            border: 1px solid var(--color-primary);
        }

        /* --- Control Tool Specific Layout --- */
        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .control-panel {
            border: 1px solid var(--color-border);
            padding: 20px;
            border-radius: 8px;
        }

        h3 {
            color: var(--color-secondary);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 10px;
        }

        .action-btn {
            flex-grow: 1;
            background-color: var(--color-secondary);
            color: var(--color-bg-dark);
        }

        .move-btn {
            background-color: var(--color-text);
            color: var(--color-bg-dark);
        }
        
        /* D-Pad Styling */
        .dpad-container {
            /* Use CSS Grid for the 3x3 layout */
            display: grid;
            grid-template-columns: repeat(3, 70px); /* Larger for mobile tap targets */
            grid-template-rows: repeat(3, 70px);
            grid-template-areas:
                ". up ."
                "left center right"
                ". down .";
            width: 210px; /* Overall width */
            height: 210px; /* Overall height */
            margin: 20px auto; /* Center on control panel */
        }

        .dpad-button {
            /* Common styling for all buttons */
            background-color: #3b82f6; /* Blue background */
            border-radius: 50%; /* Makes it circular */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #cccccc; /* Light gray color for the arrow */
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
            transition: background-color 0.1s;
        }

        .dpad-button:active {
            box-shadow: none;
            transform: translateY(2px);
        }

        /* Positioning the buttons in the grid */
        .up    { grid-area: up;    }
        .left  { grid-area: left;  }
        .right { grid-area: right; }
        .down  { grid-area: down;  }

        /* --- New Controller Styles --- */
        /* Custom styles for the circular buttons and centering - Merged from new controller */
        .circle-button {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px; /* Full circle */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.1s, box-shadow 0.1s;
            background-color: #3b82f6; /* Blue-600 */
        }

        .pill-button {
            padding: 0.75rem 2.5rem;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.1s, box-shadow 0.1s;
            min-width: 150px; /* Ensure they are wide like in the image */
            color: white; /* Ensure text is white */
        }
        
        /* Active/Pressed state visual feedback */
        .circle-button:active, .pill-button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* SVG Arrow styles for better visibility */
        .arrow-icon {
            fill: white;
            width: 30px;
            height: 30px;
        }
        
        /* Red and Green button colors */
        #btn-stop { background-color: var(--color-danger); } /* Red */
        #btn-start { background-color: var(--color-success); } /* Green */
        #btn-stop:hover { background-color: #c62828; }
        #btn-start:hover { background-color: #388e3c; }

        /* General Controller Wrapper */
        .controller-wrapper {
            /* Inherit background from tool-content, no need for controller-bg */
            padding: 20px;
            border-radius: 10px;
        }

        /* Status Display Styling */
        .status-display {
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--color-bg-dark); /* Dark background for status */
            border-radius: 8px;
            text-align: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        .status-display p {
            margin: 5px 0;
        }
        #command-status {
            font-size: 1.8em;
            font-weight: 700;
            letter-spacing: 1px;
        }
        /* End of New Controller Styles */


        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--color-card);
            border-top: 1px solid var(--color-primary);
            margin-top: 20px;
            opacity: 0.8;
        }
        
        /* Mobile-Specific Overrides */
        @media (max-width: 800px) {
            header {
                flex-direction: column;
                padding: 15px 20px;
            }
            nav ul {
                margin: 10px 0;
            }
            .controls {
                margin-top: 10px;
            }
            .container {
                padding: 10px;
            }
            h1 {
                font-size: 3em;
            }
            /* Adjusted for the new controller layout */
            .main-controller-grid {
                grid-template-columns: 1fr; /* Stack columns on small screens */
            }
            .connection-options {
                flex-direction: column;
            }
            .dpad-container {
                /* Keep D-Pad centered and large for easy tapping */
                grid-template-columns: repeat(3, 60px);
                grid-template-rows: repeat(3, 60px);
                width: 180px;
                height: 180px;
            }
            .pill-button {
                min-width: 120px;
                padding: 0.75rem 1.5rem;
            }
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Keeping Tailwind config for the controller's utility classes like 'text-yellow-400'
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Re-defining controller-bg here is not strictly necessary as we use existing CSS, 
                        // but keeping the config structure is safe.
                        'controller-bg': '#14532d', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="light-mode">
    <header>
        <div class="logo"> <img src="stemwebsite/photo_2025-11-11_20-08-29-removebg-preview.png"> T4S</div>
        <nav>
            <ul>
                
                <li><a href="#video-tool" data-i18n="nav_video">Video </a></li>
                <li><a href="#control-tool" data-i18n="nav_control">Control</a></li>
                <li><a href="#connect-tool" data-i18n="nav_connect">Connect</a></li> </ul>
        </nav>
        <div class="controls">
            <select id="language-switcher">
                <option value="en">English</option>
                <option value="kh">ááŸ’á˜áŸ‚áš</option>
            </select>
            <button id="mode-toggle" aria-label="Toggle dark/light mode">
                â˜€ï¸
            </button>
        </div>
    </header>

    <section id="hero" class="hero-3d">
        <div id="threejs-container">
            <h1 data-i18n="hero_title">ST STEM</h1>
            <p data-i18n="hero_subtitle">Controller</p>
        </div>
    </section>

    
<head>
     <section id="connect-tool" class="tool-section"></section>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bluetooth Connect</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 100px;
      background-color: #000000;
    }
    button {
      background: #0078d7;
      color: rgb(0, 0, 0);
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    #status {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
 <button id="connect-hm10">Connect HM-10 (BLE)</button>
<button id="connect-hc05">Connect HC-05 (Serial)</button>
<p id="bt-status">Status: Not connected</p>

<script>
let bleDevice = null;
let bleCharacteristic = null;
let serialPort = null;
let serialWriter = null;

// --- HM-10 BLE Connect ---
document.getElementById('connect-hm10').addEventListener('click', async () => {
    try {
        bleDevice = await navigator.bluetooth.requestDevice({
            filters: [{ namePrefix: 'HM' }], // matches HM-10 default names
            optionalServices: ['0000ffe0-0000-1000-8000-00805f9b34fb'] // HM-10 service UUID
        });
        const server = await bleDevice.gatt.connect();
        const service = await server.getPrimaryService('0000ffe0-0000-1000-8000-00805f9b34fb');
        bleCharacteristic = await service.getCharacteristic('0000ffe1-0000-1000-8000-00805f9b34fb');
        document.getElementById('bt-status').textContent = `Connected to HM-10: ${bleDevice.name}`;
    } catch (err) {
        console.error(err);
        document.getElementById('bt-status').textContent = 'BLE Connection Failed';
    }
});

// --- HC-05 Serial Connect ---
document.getElementById('connect-hc05').addEventListener('click', async () => {
    try {
        serialPort = await navigator.serial.requestPort();
        await serialPort.open({ baudRate: 9600 });
        serialWriter = serialPort.writable.getWriter();
        document.getElementById('bt-status').textContent = 'Connected to HC-05';
    } catch (err) {
        console.error(err);
        document.getElementById('bt-status').textContent = 'Serial Connection Failed';
    }
});

// --- Send Commands ---
async function sendCommand(cmd) {
    if (bleCharacteristic) {
        const data = new TextEncoder().encode(cmd);
        await bleCharacteristic.writeValue(data);
        console.log('Sent via HM-10:', cmd);
    }
    if (serialWriter) {
        await serialWriter.write(new TextEncoder().encode(cmd));
        console.log('Sent via HC-05:', cmd);
    }
}

// Example: Hooking buttons
document.getElementById('btn-forward').addEventListener('click', () => sendCommand('F'));
document.getElementById('btn-backward').addEventListener('click', () => sendCommand('B'));
document.getElementById('btn-left').addEventListener('click', () => sendCommand('L'));
document.getElementById('btn-right').addEventListener('click', () => sendCommand('R'));
document.getElementById('btn-start').addEventListener('click', () => sendCommand('S'));
document.getElementById('btn-stop').addEventListener('click', () => sendCommand('X'));
</script>

        </section>
        
  

    </section>

    <hr class="section-divider">

    <section id="video-tool" class="tool-section">
        <h2 data-i18n="sec_video_title">Video ğŸ¥</h2>
        <style>
        /* á€á»á„ááºá“áŸášáŸá˜áŸ’ášá¶á”áŸ‹áŠá¶á€áŸ‹áœá¸áŠáŸá¢á¼á‘á¶áŸ†á„á–á¸áš */
        .video-container {
            display: flex;        /* á”áŸ’ášá¾ Flexbox áŠá¾á˜áŸ’á”á¸áŠá¶á€áŸ‹áœá¸áŠáŸá¢á¼á‡á¶á”áŸ‹á‚áŸ’á“á¶ */
            gap: 20px;            /* á€áŸ†áááŸ‹á‚á˜áŸ’á›á¶áášáœá¶á„áœá¸áŠáŸá¢á¼á‘á¶áŸ†á„á–á¸áš: 2cm = 20px */
            padding: 20px;        /* á”á“áŸ’ááŸ‚á˜ padding ááŸ’á›áŸ‡áŸá˜áŸ’ášá¶á”áŸ‹á˜á¾á›á„á¶á™ */
            border: 1px solid #ccc; /* á‚áŸ’ášá¶á“áŸ‹ááŸ‚á‡á¶á”á“áŸ’á‘á¶ááŸ‹áŸá˜áŸ’ášá¶á”áŸ‹á˜á¾á›á–áŸ’ášáŸ†áŠáŸ‚á“ */
        }
        
        /* á€áŸ†áááŸ‹á›á€áŸ’áááŸˆáœá¸áŠáŸá¢á¼ */
        .video-container video {
            /* á˜á·á“á…á¶áŸ†á”á¶á…áŸ‹á€áŸ†áááŸ‹ width/height á¡á¾á„áœá·á‰á‘áŸ á–áŸ’ášáŸ„áŸ‡á˜á¶á“á€áŸ’á“á»á„ HTML attribute ášá½á…á á¾á™ */
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2); /* áŸáŸ’ášá˜áŸ„á›á”á“áŸ’áá·á…á”á“áŸ’áá½á… */
        }
    </style>
</head>
<body>

    <div class="video-container">
        <video id="robot-video-1" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
        
        <video id="robot-video-2" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
         <video id="robot-video-2" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
        
    </div>
    </video>
         <style>
        /* á€á»á„ááºá“áŸášáŸá˜áŸ’ášá¶á”áŸ‹áŠá¶á€áŸ‹áœá¸áŠáŸá¢á¼á‘á¶áŸ†á„á–á¸áš */
        .video-container {
            display: flex;        /* á”áŸ’ášá¾ Flexbox áŠá¾á˜áŸ’á”á¸áŠá¶á€áŸ‹áœá¸áŠáŸá¢á¼á‡á¶á”áŸ‹á‚áŸ’á“á¶ */
            gap: 20px;            /* á€áŸ†áááŸ‹á‚á˜áŸ’á›á¶áášáœá¶á„áœá¸áŠáŸá¢á¼á‘á¶áŸ†á„á–á¸áš: 2cm = 20px */
            padding: 20px;        /* á”á“áŸ’ááŸ‚á˜ padding ááŸ’á›áŸ‡áŸá˜áŸ’ášá¶á”áŸ‹á˜á¾á›á„á¶á™ */
            border: 1px solid #ccc; /* á‚áŸ’ášá¶á“áŸ‹ááŸ‚á‡á¶á”á“áŸ’á‘á¶ááŸ‹áŸá˜áŸ’ášá¶á”áŸ‹á˜á¾á›á–áŸ’ášáŸ†áŠáŸ‚á“ */
        }
        
        /* á€áŸ†áááŸ‹á›á€áŸ’áááŸˆáœá¸áŠáŸá¢á¼ */
        .video-container video {
            /* á˜á·á“á…á¶áŸ†á”á¶á…áŸ‹á€áŸ†áááŸ‹ width/height á¡á¾á„áœá·á‰á‘áŸ á–áŸ’ášáŸ„áŸ‡á˜á¶á“á€áŸ’á“á»á„ HTML attribute ášá½á…á á¾á™ */
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2); /* áŸáŸ’ášá˜áŸ„á›á”á“áŸ’áá·á…á”á“áŸ’áá½á… */
        }
    </style>
</head>
<body>

    <div class="video-container">
        <video id="robot-video-1" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
        <video id="robot-video-1" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video><video id="robot-video-1" 
               src="IMG_4159.MOV" 
               type="video/quicktime" 
               controls 
               loop 
               muted 
               autoplay 
               width="500px" 
               height="500px"
        >
            Your browser does not support the video tag.
        </video>
        
    </section>

    <hr class="section-divider">

    <section id="control-tool" class="tool-section">
        <h2 data-i18n="sec_control_title">Control Tool ğŸ®</h2>
        <div class="tool-content controller-wrapper">

            <div class="status-display">
                <p class="text-sm text-gray-300">Current Command:</p>
                <p id="command-status" class="text-2xl font-extrabold text-green-400">WAITING FOR INPUT</p>
            </div>

            <div class="main-controller-grid grid grid-cols-1 md:grid-cols-3 gap-8 items-center">

                <div class="flex flex-col items-center space-y-4">
                    <button id="btn-forward" class="circle-button hover:bg-blue-700" data-command="forward">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M7 14l5-5 5 5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>
                    <button id="btn-backward" class="circle-button hover:bg-blue-700" data-command="backward">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M7 10l5 5 5-5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>
                </div>

                <div class="flex flex-col items-center space-y-4 justify-center py-6 order-last md:order-none">
                    <button id="btn-stop" class="pill-button w-full" data-action="stop">
                        STOP
                    </button>
                    <button id="btn-start" class="pill-button w-full" data-action="start">
                        START
                    </button>
                </div>

                <div class="flex items-center justify-center space-x-6">
                    <button id="btn-left" class="circle-button hover:bg-blue-700" data-command="left">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M14 7l-5 5 5 5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>

                    <div class="text-xs font-semibold text-gray-300"></div>
                    <button id="btn-right" class="circle-button hover:bg-blue-700" data-command="right">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M10 7l5 5-5 5z" fill="white"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </section>
    <footer>
        <p>&copy; Stung treng.</p>
    </footer>

    <script>
        // --- Merged script.js content (Original file) ---
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const modeToggle = document.getElementById('mode-toggle');
            const langSwitcher = document.getElementById('language-switcher');
            // Check for existence of connect buttons before assigning to avoid null errors on page load
            const connectBluetoothBtn = document.getElementById('connect-bluetooth-btn');
            const disconnectBluetoothBtn = document.getElementById('disconnect-bluetooth-btn');
            const connectionState = document.getElementById('connection-state');

            // --- 1. Language Data Structure ---
            const translations = {
                en: {
                    title: "Stemkits controller", // Corrected title
                    nav_video: "Video",
                    nav_control: "Control",
                    nav_connect: "Connect",
                    hero_title: "ST STEM",
                    hero_subtitle: "Controller",
                    sec_connect_title: "Connection ğŸ“¡",
                    sec_connect_desc: "Establish a secure connection to the robot arm via Web Bluetooth for direct mobile control.",
                    btn_connect_bluetooth: "Connect via Bluetooth (Mobile Controller)",
                    btn_disconnect_bluetooth: "Disconnect",
                    bluetooth_note: "*Requires HTTPS and a browser supporting the Web Bluetooth API (e.g., Chrome, Edge).",
                    status_disconnected: "Status: Disconnected",
                    status_connected: "Status: Connected",
                    sec_video_title: "Video ğŸ¥", // Corrected title
                    sec_video_desc: "connect with robot.",
                    sec_control_title: "Control Tool ğŸ®",
                
                },
                kh: {
                    title: "á€á˜áŸ’á˜áœá·á’á¸á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á§á”á€ášááŸ Stemkits", // Added Kh title
                    nav_video: "á§á”á€ášááŸáœá¸áŠáŸá¢á¼", 
                    nav_control: "á§á”á€ášááŸá”á‰áŸ’á‡á¶", 
                    nav_connect: "á—áŸ’á‡á¶á”áŸ‹",
                    hero_title: "ST STEM", 
                    hero_subtitle: "á”á‰áŸ’á‡á¶", 
                    sec_connect_title: "á€á˜áŸ’á˜áœá·á’á¸á‚áŸ’ášá”áŸ‹á‚áŸ’ášá„á€á¶ášáá—áŸ’á‡á¶á”áŸ‹ ğŸ“¡",
                    sec_connect_desc: "á”á„áŸ’á€á¾áá€á¶ášáá—áŸ’á‡á¶á”áŸ‹áŠáŸ‚á›á˜á¶á“áŸá»áœááŸ’áá·á—á¶á–á‘áŸ…á€á¶á“áŸ‹áŠáŸƒášáŸ‰á¼á”á¼ááá¶á˜ášá™áŸˆ Web Bluetooth áŸá˜áŸ’ášá¶á”áŸ‹á€á¶ášá‚áŸ’ášá”áŸ‹á‚áŸ’ášá„áŠáŸ„á™á•áŸ’á‘á¶á›áŸ‹áŸ”",
                    btn_connect_bluetooth: "á—áŸ’á‡á¶á”áŸ‹áá¶á˜ášá™áŸˆá”áŸŠáŸ’á›á¼á’á¼áŸ (á§á”á€ášááŸá”á‰áŸ’á‡á¶á…á›áŸá)",
                    btn_disconnect_bluetooth: "á•áŸ’áá¶á…áŸ‹",
                    bluetooth_note: "*á‘á¶á˜á‘á¶áš HTTPS á“á·á„á€á˜áŸ’á˜áœá·á’á¸ášá»á€ášá€áŠáŸ‚á›á‚á¶áŸ†á‘áŸ’áš Web Bluetooth API (áŠá¼á…á‡á¶ Chrome, Edge)áŸ”",
                    status_disconnected: "áŸáŸ’áá¶á“á—á¶á–: á•áŸ’áá¶á…áŸ‹",
                    status_connected: "áŸáŸ’áá¶á“á—á¶á–: á—áŸ’á‡á¶á”áŸ‹",
                    sec_video_title: "á§á”á€ášááŸáœá¸áŠáŸá¢á¼ ğŸ¥",
                    sec_video_desc: "á—áŸ’á‡á¶á”áŸ‹á‘áŸ…á€á¶á“áŸ‹ robotáŸ”",
                    sec_control_title: "á§á”á€ášááŸá”á‰áŸ’á‡á¶ ğŸ®",
                },
            
            };

            // --- 2. Dark/Light Mode Toggle ---
            const currentMode = localStorage.getItem('mode') || 'dark';
            body.className = currentMode + '-mode';
            modeToggle.textContent = currentMode === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';

            modeToggle.addEventListener('click', () => {
                const newMode = body.classList.contains('light-mode') ? 'dark' : 'light';
                body.className = newMode + '-mode';
                modeToggle.textContent = newMode === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
                localStorage.setItem('mode', newMode);
            });

            // --- 3. Localization Functionality ---
            const setLanguage = (lang) => {
                const elements = document.querySelectorAll('[data-i18n]');
                const texts = translations[lang];
                if (!texts) return;

                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) {
                        if (key === 'title') {
                            document.title = texts[key];
                        } 
                        else if (el.tagName !== 'SELECT') { // Exclude the SELECT element itself
                            el.textContent = texts[key];
                        }

                        // Special handling for button text/status text
                        if (el.id === 'connection-state' && connectionState) {
                             // Update the status text based on current connection state
                             const isConnected = el.classList.contains('connected');
                             el.textContent = isConnected ? texts['status_connected'] : texts['status_disconnected'];
                        } else if (el.id === 'connect-bluetooth-btn' && connectBluetoothBtn) {
                            // Ensure button text is set
                            connectBluetoothBtn.textContent = texts['btn_connect_bluetooth'];
                        } else if (el.id === 'disconnect-bluetooth-btn' && disconnectBluetoothBtn) {
                            // Ensure button text is set
                            disconnectBluetoothBtn.textContent = texts['btn_disconnect_bluetooth'];
                        }
                    }
                });
                localStorage.setItem('lang', lang);
            };

            langSwitcher.value = localStorage.getItem('lang') || 'en';
            setLanguage(langSwitcher.value);

            langSwitcher.addEventListener('change', (event) => {
                setLanguage(event.target.value);
            });
            
            // --- Connection Status UI Update Function ---
            const updateConnectionState = (isConnected) => {
                if (!connectionState) return; // Guard for null element
                const lang = langSwitcher.value;
                const texts = translations[lang];

                if (isConnected) {
                    connectionState.classList.remove('disconnected');
                    connectionState.classList.add('connected');
                    connectionState.textContent = texts['status_connected'];
                    if(connectBluetoothBtn) connectBluetoothBtn.disabled = true;
                    if(disconnectBluetoothBtn) disconnectBluetoothBtn.disabled = false;
                } else {
                    connectionState.classList.remove('connected');
                    connectionState.classList.add('disconnected');
                    connectionState.textContent = texts['status_disconnected'];
                    if(connectBluetoothBtn) connectBluetoothBtn.disabled = false;
                    if(disconnectBluetoothBtn) disconnectBluetoothBtn.disabled = true;
                }
            };


            // --- 4. Web Bluetooth Connection Logic (Mock/Placeholder) ---
            let bluetoothDevice = null;
            let controlCharacteristic = null; // GATT characteristic for sending commands

            // MOCK/PLACEHOLDER: Replace with actual Web Bluetooth API logic
            const connectBluetooth = async () => {
                 console.log('Attempting to connect via Web Bluetooth...');
                 updateConnectionState(true); // Mock successful connection
            };

            const disconnectBluetooth = () => {
                console.log('Disconnecting from Bluetooth...');
                updateConnectionState(false); // Mock disconnection
            };
            
            if (connectBluetoothBtn) connectBluetoothBtn.addEventListener('click', connectBluetooth);
            if (disconnectBluetoothBtn) disconnectBluetoothBtn.addEventListener('click', disconnectBluetooth);
            
            // Initial state setup
            updateConnectionState(false); 


            // --- 5. D-Pad Control Logic (Continuous command placeholder) ---
            const dpadButtons = document.querySelectorAll('.dpad-button');
            
            const sendCommand = (commandKey) => {
                // This original logic seems to be for a different D-pad. 
                // We'll keep the new controller's logic below for the integrated buttons.
                console.log(`Sending command: ${commandKey}`);
            }
            
            // This is the old D-Pad logic from the original index.html file. 
            // It is kept for completeness but is likely not needed now.
            /*
            dpadButtons.forEach(button => {
                // Use mousedown and touchstart for continuous action
                button.addEventListener('mousedown', (e) => {
                    const commandKey = button.getAttribute('data-command');
                    sendCommand(commandKey);
                });
                
                button.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // Prevent mobile scrolling/default action
                    const commandKey = button.getAttribute('data-command');
                    sendCommand(commandKey);
                });

                // Use mouseup, mouseleave, and touchend for sending a 'STOP' command
                const stopEvent = () => {
                     sendCommand('CMD_STOP'); // Placeholder stop command
                };

                button.addEventListener('mouseup', stopEvent);
                button.addEventListener('mouseleave', stopEvent);
                button.addEventListener('touchend', stopEvent);
            });
            */
        });

        // --- Controller Script Content (from the second file) ---

        // Global state for tracking the engine status (optional, but good practice)
        let isEngineRunning = false;

        /**
         * Updates the status display on the screen.
         * @param {string} message - The command message to display.
         * @param {string} color - Tailwind color class for the text.
         */
        function updateStatus(message, color = 'text-green-400') {
            const statusElement = document.getElementById('command-status');
            if (!statusElement) return;

            statusElement.textContent = message;
            // Clear previous color classes
            // We use standard CSS classes now, so clear based on common text color prefixes
            statusElement.className = statusElement.className.split(' ').filter(cls => !cls.startsWith('text-')).join(' ');
            // Add new color class (using Tailwind classes included via the script tag)
            statusElement.classList.add(color);
        }

        /**
         * Simulates sending a movement command.
         * @param {string} direction - 'forward', 'backward', 'left', or 'right'.
         */
        function handleMoveCommand(direction) {
            if (!isEngineRunning && direction !== 'stop') {
                updateStatus('Engine is OFF. Press START first!', 'text-yellow-400');
                return;
            }

            let message;
            // let command_url; // In a real app, this would be the URL to the IoT device

            switch (direction) {
                case 'forward':
                    message = 'MOVING FORWARD';
                    // command_url = '/api/move?dir=forward';
                    break;
                case 'backward':
                    message = 'MOVING BACKWARD';
                    // command_url = '/api/move?dir=backward';
                    break;
                case 'left':
                    message = 'TURNING LEFT';
                    // command_url = '/api/move?dir=left';
                    break;
                case 'right':
                    message = 'TURNING RIGHT';
                    // command_url = '/api/move?dir=right';
                    break;
                default:
                    message = 'Invalid Movement Command';
                    return;
            }

            updateStatus(message, 'text-blue-400');
            // console.log(`[API Call] Sending: ${command_url}`); // Uncomment for real use
        }

        /**
         * Simulates sending the START or STOP command.
         * @param {string} action - 'start' or 'stop'.
         */
        function handleEngineAction(action) {
            if (action === 'start') {
                if (!isEngineRunning) {
                    isEngineRunning = true;
                    updateStatus('ENGINE STARTED! Ready to drive.', 'text-green-400');
                    // console.log('[API Call] Sending: /api/engine?action=start');
                } else {
                    updateStatus('Engine is already running.', 'text-green-500');
                }
            } else if (action === 'stop') {
                if (isEngineRunning) {
                    isEngineRunning = false;
                    updateStatus('ENGINE STOPPED.', 'text-red-400');
                    // console.log('[API Call] Sending: /api/engine?action=stop');
                } else {
                    updateStatus('Engine is already stopped.', 'text-red-500');
                }
            }
        }


        // --- Event Handlers (Controller) ---

        // 1. On-Screen Button Listeners
        function setupButtonListeners() {
            document.querySelectorAll('[data-command]').forEach(button => {
                button.addEventListener('click', () => {
                    handleMoveCommand(button.dataset.command);
                });
            });

            const startBtn = document.getElementById('btn-start');
            const stopBtn = document.getElementById('btn-stop');

            if (startBtn) startBtn.addEventListener('click', () => {
                handleEngineAction('start');
            });
            if (stopBtn) stopBtn.addEventListener('click', () => {
                handleEngineAction('stop');
            });
        }

        // 2. Keyboard Listeners (W, A, S, D)
        const keyMap = {
            'w': 'forward',
            's': 'backward',
            'a': 'left',
            'd': 'right',
            'W': 'forward',
            'S': 'backward',
            'A': 'left',
            'D': 'right',
            // Also map arrow keys for convenience
            'ArrowUp': 'forward',
            'ArrowDown': 'backward',
            'ArrowLeft': 'left',
            'ArrowRight': 'right',
            'Enter': 'start', // Start with Enter
            'Escape': 'stop'  // Stop with Escape
        };

        let activeKey = null; // To prevent rapid-fire repeated commands on hold

        window.addEventListener('keydown', (event) => {
            const command = keyMap[event.key];

            if (command && command !== activeKey) {
                event.preventDefault(); // Prevent default browser action (like scrolling)
                activeKey = command;

                if (command === 'start') {
                    handleEngineAction('start');
                } else if (command === 'stop') {
                    handleEngineAction('stop');
                } else {
                    // Check if a move button exists and visually highlight it
                    const button = document.getElementById(`btn-${command}`);
                    if (button) {
                        // Using the :active pseudo-class in CSS is better for click/touch,
                        // but for keyboard, we manually add classes simulating the pressed state
                        button.classList.add('scale-95'); // Tailwind class for scale
                        button.style.boxShadow = 'none'; // Clear box shadow on press
                    }
                    handleMoveCommand(command);
                }
            }
        });

        window.addEventListener('keyup', (event) => {
            const command = keyMap[event.key];

            if (command) {
                // Clear active key only if it was the one released
                if (command === activeKey) {
                    activeKey = null;
                }
                 // Remove visual highlight from move buttons
                const button = document.getElementById(`btn-${command}`);
                if (button) {
                    button.classList.remove('scale-95');
                    button.style.boxShadow = ''; // Restore box shadow
                }
            }
        });

        // --- Initialization ---
        window.onload = function() {
            setupButtonListeners();
            updateStatus('Press START or W/A/S/D to drive!', 'text-gray-300');
        };
    </script>
</body>
</html>
