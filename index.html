<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>stem kit controller</title>
</head>
<body>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title data-i18n="title">Stemkits cotroller</title>
    <style>
        /* --- Global Variables and Resets --- */
        :root {
            --color-primary: #00bcd4; /* Cyan/Aqua - Professional Tech Look */
            --color-secondary: #ff9800; /* Orange/Amber for Warnings/Highlights */
            --color-danger: #e53935; /* Red for Emergency Stop */
            --color-success: #4caf50; /* Green for Connection Status */
            
            /* Dark Mode (Default) */
            --color-text-dark: #e0e0e0;
            --color-bg-dark: #1e1e1e;
            --color-card-dark: #2a2a2a;
            --color-border-dark: #3a3a3a;
            
            /* Light Mode */
            --color-text-light: #333;
            --color-bg-light: #f4f7f9;
            --color-card-light: #ffffff;
            --color-border-light: #e0e0e0;

            --transition-speed: 0.3s;
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* Base theme switching */
        .dark-mode {
            --color-text: var(--color-text-dark);
            --color-background: var(--color-bg-dark);
            --color-card: var(--color-card-dark);
            --color-border: var(--color-border-dark);
        }

        .light-mode {
            --color-text: var(--color-text-light);
            --color-background: var(--color-bg-light);
            --color-card: var(--color-card-light);
            --color-border: var(--color-border-light);
            --box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color var(--transition-speed), color var(--transition-speed), border-color var(--transition-speed), box-shadow var(--transition-speed);
        }

     body {
    font-family: 'Roboto', sans-serif;
    background: url('c:\Users\Dell\Downloads\Telegram Desktop\photo_2025-11-11_20-08-29.jpg') no-repeat center center fixed;
    background-size: cover;
    color: var(--color-text);
    line-height: 1.6;
}
s


        

        .container {
            max-width: 1300px;
            margin: 0 auto;
            padding: 20px;
        }

        /* --- Header & Navigation --- */
        header {
            background-color: var(--color-card);
            border-bottom: 1px solid var(--color-primary);
            padding: 15px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 1.8em;
            font-weight: 900;
            color: var(--color-primary);
            letter-spacing: 2px;
        }

        nav ul {
            list-style: none;
            display: flex;
        }

        nav ul li a {
            color: var(--color-text);
            text-decoration: none;
            padding: 10px 15px;
            margin: 0 5px;
            font-weight: 500;
            border-bottom: 2px solid transparent;
        }

        nav ul li a:hover {
            color: var(--color-primary);
            border-color: var(--color-primary);
        }

        /* --- Hero/3D Section (Stylish Stems) --- */
       .hero-3d {
    height: 70vh;
    background: url('a969ab4c-bdcf-439e-bcb8-d1afb6c8ae9f.png') no-repeat center center;
    background-size: cover;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
    overflow: hidden;
    border-bottom: 3px solid var(--color-primary);
}
        h1 {
            font-size: 4em;
            margin-bottom: 10px;
            font-weight: 700;
            text-shadow: 0 0 10px rgba(0, 188, 212, 0.5);
        }

        /* --- General Tool Section Styling --- */
        .tool-section {
            padding: 40px 0;
        }

        .section-divider {
            border: none;
            height: 1px;
            background-color: var(--color-border);
            margin: 20px 0;
        }

        .section-divider-small {
            border: none;
            height: 1px;
            background-color: var(--color-border);
            margin: 15px 0;
        }

        h2 {
            font-size: 2.5em;
            color: var(--color-primary);
            margin-bottom: 25px;
            border-left: 6px solid var(--color-primary);
            padding-left: 15px;
            font-weight: 300;
        }

        .tool-content {
            background-color: var(--color-card);
            padding: 30px;
            border-radius: 10px;
            box-shadow: var(--box-shadow);
        }

        /* Button Base Styles */
        button {
            border: none;
            padding: 12px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            text-transform: uppercase;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        /* --- Connect Tool Styling --- */
        .connection-status {
            text-align: center;
            margin-bottom: 20px;
        }

        #connection-state {
            font-size: 1.5em;
            font-weight: 700;
            padding: 10px 20px;
            border-radius: 5px;
            color: var(--color-bg-dark);
            display: inline-block; /* Added for proper padding and background */
        }

        .disconnected {
            background-color: var(--color-danger);
            animation: blink-red 2s infinite;
        }

        .connected {
            background-color: var(--color-success);
            animation: none;
        }

        @keyframes blink-red {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        .connection-options {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .connect-btn {
            flex-grow: 1;
            color: white;
            background-color: var(--color-secondary); /* Bluetooth color */
        }

        .connect-btn:hover {
            background-color: #d17500;
        }

        .danger-btn {
            background-color: #616161; /* Disconnect button (greyed out when disabled) */
            color: white;
        }

        .danger-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        .bluetooth-note {
            font-size: 0.9em;
            opacity: 0.7;
            margin-top: 10px;
        }

        /* --- Video Placeholder --- */
        .video-placeholder {
            background-color: #000;
            height: 450px;
            border-radius: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-style: italic;
            font-size: 1.5em;
            border: 1px solid var(--color-primary);
        }

        /* --- Control Tool Specific Layout --- */
        .control-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .control-panel {
            border: 1px solid var(--color-border);
            padding: 20px;
            border-radius: 8px;
        }

        h3 {
            color: var(--color-secondary);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--color-border);
            padding-bottom: 10px;
        }

        .action-btn {
            flex-grow: 1;
            background-color: var(--color-secondary);
            color: var(--color-bg-dark);
        }

        .move-btn {
            background-color: var(--color-text);
            color: var(--color-bg-dark);
        }
        
        /* D-Pad Styling */
        .dpad-container {
            /* Use CSS Grid for the 3x3 layout */
            display: grid;
            grid-template-columns: repeat(3, 70px); /* Larger for mobile tap targets */
            grid-template-rows: repeat(3, 70px);
            grid-template-areas:
                ". up ."
                "left center right"
                ". down .";
            width: 210px; /* Overall width */
            height: 210px; /* Overall height */
            margin: 20px auto; /* Center on control panel */
        }

        .dpad-button {
            /* Common styling for all buttons */
            background-color: #3b82f6; /* Blue background */
            border-radius: 50%; /* Makes it circular */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #000000; /* Light gray color for the arrow */
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.4);
            transition: background-color 0.1s;
        }

        .dpad-button:active {
            box-shadow: none;
            transform: translateY(2px);
        }

        /* Positioning the buttons in the grid */
        .up    { grid-area: up;    }
        .left  { grid-area: left;  }
        .right { grid-area: right; }
        .down  { grid-area: down;  }

        /* --- New Controller Styles --- */
        /* Custom styles for the circular buttons and centering - Merged from new controller */
        .circle-button {
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 9999px; /* Full circle */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.1s, box-shadow 0.1s;
            background-color: #3b82f6; /* Blue-600 */
        }

        .pill-button {
            padding: 0.75rem 2.5rem;
            border-radius: 9999px;
            font-weight: 700;
            text-transform: uppercase;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
            transition: transform 0.1s, box-shadow 0.1s;
            min-width: 150px; /* Ensure they are wide like in the image */
            color: white; /* Ensure text is white */
        }
        
        /* Active/Pressed state visual feedback */
        .circle-button:active, .pill-button:active {
            transform: scale(0.95);
            box-shadow: 0 2px 4px rgb(0, 0, 0);
        }

        /* SVG Arrow styles for better visibility */
        .arrow-icon {
            fill: white;
            width: 30px;
            height: 30px;
        }
        
        /* Red and Green button colors */
        #btn-stop { background-color: var(--color-danger); } /* Red */
        #btn-start { background-color: var(--color-success); } /* Green */
        #btn-stop:hover { background-color: #c62828; }
        #btn-start:hover { background-color: #388e3c; }

        /* General Controller Wrapper */
        .controller-wrapper {
            /* Inherit background from tool-content, no need for controller-bg */
            padding: 20px;
            border-radius: 10px;
        }

        /* Status Display Styling */
        .status-display {
            margin-bottom: 20px;
            padding: 10px;
            background-color: var(--color-bg-dark); /* Dark background for status */
            border-radius: 8px;
            text-align: center;
            box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.5);
        }
        .status-display p {
            margin: 5px 0;
        }
        #command-status {
            font-size: 1.8em;
            font-weight: 700;
            letter-spacing: 1px;
        }
        /* End of New Controller Styles */


        /* Footer */
        footer {
            text-align: center;
            padding: 20px;
            background-color: var(--color-card);
            border-top: 1px solid var(--color-primary);
            margin-top: 20px;
            opacity: 0.8;
        }
        
        /* Mobile-Specific Overrides */
        @media (max-width: 800px) {
            header {
                flex-direction: column;
                padding: 15px 20px;
            }
            nav ul {
                margin: 10px 0;
            }
            .controls {
                margin-top: 10px;
            }
            .container {
                padding: 10px;
            }
            h1 {
                font-size: 3em;
            }
            /* Adjusted for the new controller layout */
            .main-controller-grid {
                grid-template-columns: 1fr; /* Stack columns on small screens */
            }
            .connection-options {
                flex-direction: column;
            }
            .dpad-container {
                /* Keep D-Pad centered and large for easy tapping */
                grid-template-columns: repeat(3, 60px);
                grid-template-rows: repeat(3, 60px);
                width: 180px;
                height: 180px;
            }
            .pill-button {
                min-width: 120px;
                padding: 0.75rem 1.5rem;
            }
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Keeping Tailwind config for the controller's utility classes like 'text-yellow-400'
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // Re-defining controller-bg here is not strictly necessary as we use existing CSS, 
                        // but keeping the config structure is safe.
                        'controller-bg': '#14532d', 
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
</head>
<body class="light-mode">
    <header>
       <div class="logo">
       Teach 4 School
</div> 

        <nav>
            <ul>
                
                <li><a href="#video-tool" data-i18n="nav_video">Video </a></li>
                <li><a href="#connect-tool" data-i18n="nav_connect">Connect</a></li>
                <li><a href="#contact-tool" data-i18n="nav_contact">Contact</a></li>
                <li><a href="#code-tool" data-i18n="nav_code">Code</a></li> 
             </ul>
        </nav>
        <div class="controls">
            <select id="language-switcher">
                <option value="en">English</option>
                <option value="kh">·ûÅ·üí·ûò·üÇ·ûö</option>
            </select>
            <button id="mode-toggle" aria-label="Toggle dark/light mode">
                ‚òÄÔ∏è
            </button>
        </div>
    </header>

    <section id="hero" class="hero-3d">
        <div id="threejs-container">
            <h1 data-i18n="hero_title">EDUCATION ROBT KIT </h1>
            <p data-i18n="hero_subtitle">Controller</p>
        </div>
    </section>

    
<head>
     <section id="connect-tool" class="tool-section"></section>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bluetooth Connect</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 100px;
      background-color: #000000;
    }
    button {
      background: #0078d7;
      color: rgb(0, 0, 0);
      border: none;
      padding: 15px 30px;
      border-radius: 8px;
      font-size: 18px;
      cursor: pointer;
    }
    button:hover {
      background: #005fa3;
    }
    #status {
      margin-top: 20px;
      font-size: 18px;
    }
  </style>
</head>
<body>
 <button id="connect-hm10">Connect HM-10 (BLE)</button>
<button id="connect-hc05">Connect HC-05 (Serial)</button>
<p id="bt-status">Status: Not connected</p>

<script>
let bleDevice = null;
let bleCharacteristic = null;
let serialPort = null;
let serialWriter = null;

// --- HM-10 BLE Connect ---
document.getElementById('connect-hm10').addEventListener('click', async () => {
    try {
        bleDevice = await navigator.bluetooth.requestDevice({
            filters: [{ namePrefix: 'HM' }], // matches HM-10 default names
            optionalServices: ['0000ffe0-0000-1000-8000-00805f9b34fb'] // HM-10 service UUID
        });
        const server = await bleDevice.gatt.connect();
        const service = await server.getPrimaryService('0000ffe0-0000-1000-8000-00805f9b34fb');
        bleCharacteristic = await service.getCharacteristic('0000ffe1-0000-1000-8000-00805f9b34fb');
        document.getElementById('bt-status').textContent = `Connected to HM-10: ${bleDevice.name}`;
    } catch (err) {
        console.error(err);
        document.getElementById('bt-status').textContent = 'BLE Connection Failed';
    }
});

// --- HC-05 Serial Connect ---
document.getElementById('connect-hc05').addEventListener('click', async () => {
    try {
        serialPort = await navigator.serial.requestPort();
        await serialPort.open({ baudRate: 9600 });
        serialWriter = serialPort.writable.getWriter();
        document.getElementById('bt-status').textContent = 'Connected to HC-05';
    } catch (err) {
        console.error(err);
        document.getElementById('bt-status').textContent = 'Serial Connection Failed';
    }
});

// --- Send Commands ---
async function sendCommand(cmd) {
    if (bleCharacteristic) {
        const data = new TextEncoder().encode(cmd);
        await bleCharacteristic.writeValue(data);
        console.log('Sent via HM-10:', cmd);
    }
    if (serialWriter) {
        await serialWriter.write(new TextEncoder().encode(cmd));
        console.log('Sent via HC-05:', cmd);
    }
}

// Example: Hooking buttons
document.getElementById('btn-forward').addEventListener('click', () => sendCommand('F'));
document.getElementById('btn-backward').addEventListener('click', () => sendCommand('B'));
document.getElementById('btn-left').addEventListener('click', () => sendCommand('L'));
document.getElementById('btn-right').addEventListener('click', () => sendCommand('R'));
document.getElementById('btn-start').addEventListener('click', () => sendCommand('S'));
document.getElementById('btn-stop').addEventListener('click', () => sendCommand('X'));
</script>

        </section>
        
  

    </section>

    <hr class="section-divider">

    <section id="video-tool" class="tool-section">
        <h2 data-i18n="sec_video_title">Video üé•</h2>
        <p>set up robot</p>
      <button onclick="window.open('https://photos.app.goo.gl/iv9NdfWSZDuYxMit8', '_blank')">
    Watch video
</button>

        
    </section>

    <hr class="section-divider">

    <!-- Button to open ST Teach4School Facebook page --<section id="control-tool" class="tool-section">
        <h2 data-i18n="sec_control_title">Control Tool üéÆ</h2>
        <div class="tool-content controller-wrapper">

            <div class="status-display">
                <p class="text-sm text-gray-300">Current Command:</p>
                <p id="command-status" class="text-2xl font-extrabold text-green-400">WAITING FOR INPUT</p>
            </div>

            <div class="main-controller-grid grid grid-cols-1 md:grid-cols-3 gap-8 items-center">

                <div class="flex flex-col items-center space-y-4">
                    <button id="btn-forward" class="circle-button hover:bg-blue-700" data-command="forward">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M7 14l5-5 5 5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>
                    <button id="btn-backward" class="circle-button hover:bg-blue-700" data-command="backward">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M7 10l5 5 5-5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>
                </div>

                <div class="flex flex-col items-center space-y-4 justify-center py-6 order-last md:order-none">
                    <button id="btn-stop" class="pill-button w-full" data-action="stop">
                        STOP
                    </button>
                     <button id="btn-start" class="pill-button w-full" data-action="start">
                        START
                    </button>
                   
                </div>

                <div class="flex items-center justify-center space-x-6">
                    <button id="btn-left" class="circle-button hover:bg-blue-700" data-command="left">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M14 7l-5 5 5 5z" fill="white"/>
                        </svg>
                    </button>
                    <div class="text-xs font-semibold text-gray-300"></div>

                    <div class="text-xs font-semibold text-gray-300"></div>
                    <button id="btn-right" class="circle-button hover:bg-blue-700" data-command="right">
                        <svg class="arrow-icon" viewBox="0 0 24 24">
                            <path d="M10 7l5 5-5 5z" fill="white"/>
                        </svg>
                    </button>
                </div>
            </div>
             <!-- ===== AUTO-MODE BUTTONS SECTION ===== --
        <div class="auto-mode-controller flex flex-col md:flex-row justify-center gap-6 mt-10">

            <!-- Follow Object Mode --
            <button id="btn-follow" class="pill-button bg-purple-600 hover:bg-purple-700 w-full md:w-1/3"
                    onclick="enableFollowObjectMode()">
                FOLLOW OBJECT ü§ñ
            </button>

            <!-- Obstacle Avoid Mode --
            <button id="btn-avoid" class="pill-button bg-yellow-600 hover:bg-yellow-700 w-full md:w-1/3"
                    onclick="enableObstacleAvoidMode()">
                OBSTACLE AVOIDANCE üöß
            </button>
        </div>
        </div>
    </section>
                <!-- Obstacle Avoid Mode -->
     </section>
    <section id="contact-tool" class="tool-section">
    <h2 data-i18n="sec_contact_title">Contact Us ‚òéÔ∏è</h2>

    <div class="tool-content" style="text-align: center;">
        <p style="font-size: 1.2em; margin-bottom: 20px;">
            Contact the <strong> Teach4School</strong> 
        </p>

        <a href="https://www.facebook.com/share/17QjM8aWM7/" 
           target="_blank"
           style="
                display: inline-block;
                background-color: #5395ea;
                color: rgb(207, 199, 199);
                padding: 12px 25px;
                font-size: 1.2em;
                border-radius: 8px;
                text-decoration: none;
                box-shadow: 0 4px 10px rgba(0,0,0,0.2);
           ">
            üìò Message Us on Facebook
        </a>
    </div>
</section>
    <section id="code-tool" class="tool-section">
    <h2>Arduino Code Tool üß©</h2>

    <div class="tool-content">
        <p style="margin-bottom: 15px; font-size: 1.1em;">
           code for raoming mod.
        </p>

        <textarea id="arduino-code-box" 
            style="
                width: 100%;
                height: 500px;
                background-color: #1e1e1e;
                color: #00e676;
                padding: 15px;
                border-radius: 10px;
                font-size: 14px;
                font-family: 'Courier New', monospace;
                border: 1px solid #333;
                white-space: pre;
                overflow: auto;
            ">
// Define motor pins
int In1 = 6;   // IN1
int In2 = 7;   // IN2
int In3 = 8;   // IN3
int In4 = 9;   // IN4
int ENA = 5;   // PWM for motor A
int ENB = 10;  // PWM for motor B

// BLUETOOTH SETUP - MUST HAVE THIS!
#include <SoftwareSerial.h>
SoftwareSerial btSerial(2, 3);  // RX, TX for HC-05/HC-06

void setup() {
  Serial.begin(9600);    // For Serial Monitor debugging
  btSerial.begin(9600);  // For Bluetooth HC-05/HC-06
  
  pinMode(In1, OUTPUT);
  pinMode(In2, OUTPUT);
  pinMode(In3, OUTPUT);
  pinMode(In4, OUTPUT);
  pinMode(ENA, OUTPUT);
  pinMode(ENB, OUTPUT);
  
  stopMotors();  // Ensure motors are stopped at startup
  
  delay(1000);   // Give Bluetooth time to initialize
  Serial.println("Robot Ready - Serial Monitor OK");
  btSerial.println("Robot Ready - Bluetooth OK");  // Send to Bluetooth
}

void loop() {
  // 1. CHECK BLUETOOTH FIRST (HC-05/HC-06)
  if (btSerial.available()) {
    char command = btSerial.read();
    Serial.print("Bluetooth CMD: ");  // Debug to Serial Monitor
    Serial.println(command);
    btSerial.print("Received: ");     // Confirm to Bluetooth app
    btSerial.println(command);
    controlMotors(command);
  }
  
  // 2. CHECK SERIAL MONITOR (for testing)
  if (Serial.available()) {
    char command = Serial.read();
    Serial.print("Serial CMD: ");
    Serial.println(command);
    controlMotors(command);
  }
}

void stopMotors() {
  digitalWrite(In1, LOW);
  digitalWrite(In2, LOW);
  digitalWrite(In3, LOW);
  digitalWrite(In4, LOW);
  analogWrite(ENA, 0);
  analogWrite(ENB, 0);
}

void controlMotors(char command) {
  // Convert to uppercase to handle both cases
  if (command >= 'a' && command <= 'z') {
    command = command - 32;
  }
  
  switch (command) {
    case 'F': // Move Forward
      digitalWrite(In1, LOW);
      digitalWrite(In2, HIGH);
      digitalWrite(In3, HIGH);
      digitalWrite(In4, LOW);
      analogWrite(ENA, 200); // Reduced speed for stability
      analogWrite(ENB, 200);
      btSerial.println("Action: FORWARD");
      Serial.println("Action: FORWARD");
      break;
      
    case 'B': // Move Backward
      digitalWrite(In1, HIGH);
      digitalWrite(In2, LOW);
      digitalWrite(In3, LOW);
      digitalWrite(In4, HIGH);
      analogWrite(ENA, 200);
      analogWrite(ENB, 200);
      btSerial.println("Action: BACKWARD");
      Serial.println("Action: BACKWARD");
      break;
      
    case 'L': // Turn Left - FIXED DIRECTION
      digitalWrite(In1, HIGH);  // Left motor BACKWARD
      digitalWrite(In2, LOW);
      digitalWrite(In3, HIGH);  // Right motor FORWARD  
      digitalWrite(In4, LOW);
      analogWrite(ENA, 180);
      analogWrite(ENB, 180);
      btSerial.println("Action: LEFT TURN");
      Serial.println("Action: LEFT TURN");
      break;
      
    case 'R': // Turn Right - FIXED DIRECTION
      digitalWrite(In1, LOW);   // Left motor FORWARD
      digitalWrite(In2, HIGH);
      digitalWrite(In3, LOW);   // Right motor BACKWARD
      digitalWrite(In4, HIGH);
      analogWrite(ENA, 180);
      analogWrite(ENB, 180);
      btSerial.println("Action: RIGHT TURN");
      Serial.println("Action: RIGHT TURN");
      break;
      
    case 'S': // Stop
      stopMotors();
      btSerial.println("Action: STOP");
      Serial.println("Action: STOP");
      break;
      
    default: // Unknown command
      btSerial.println("Error: Unknown command");
      Serial.println("Error: Unknown command");
      break;
  }
}
        </textarea>

       

    </div>
</section>
    <footer>
        <p>&copy; Teach 4 School.</p>
    </footer>

    <script>
        // --- Merged script.js content (Original file) ---
        document.addEventListener('DOMContentLoaded', () => {
            const body = document.body;
            const modeToggle = document.getElementById('mode-toggle');
            const langSwitcher = document.getElementById('language-switcher');
            // Check for existence of connect buttons before assigning to avoid null errors on page load
            const connectBluetoothBtn = document.getElementById('connect-bluetooth-btn');
            const disconnectBluetoothBtn = document.getElementById('disconnect-bluetooth-btn');
            const connectionState = document.getElementById('connection-state');

           const translations = {
    en: {
        title: "Stemkits Controller",
        nav_video: "Video",
        nav_control: "Control",
        nav_connect: "Connect",
        nav_code: "Code",
        nav_contact: "Contact",

        hero_title: "EDUCATION ROBOT KIT",
        hero_subtitle: "Controller",

        sec_connect_title: "Connection üì°",
        sec_connect_desc: "Connect to your robot via Bluetooth or Serial.",

        btn_connect_bluetooth: "Connect via Bluetooth",
        btn_disconnect_bluetooth: "Disconnect",

        status_connected: "Status: Connected",
        status_disconnected: "Status: Not Connected",

        sec_video_title: "Video üé•",
        sec_video_desc: "Live robot video display.",

        sec_control_title: "Control Tool üéÆ",
         sec_connect_title: "connect",
         sec_code_title: "code",
         sec_code_title: "contact us",
    },

    kh: {
        title: "·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏·ûÇ·üí·ûö·ûî·üã·ûÇ·üí·ûö·ûÑ Stemkits",
        nav_video: "·ûú·û∏·ûä·üÅ·û¢·ûº",
        nav_control: "·ûî·ûâ·üí·ûá·û∂",
        nav_connect: "·ûó·üí·ûá·û∂·ûî·üã",
          nav_code: "·ûÄ·ûº·ûä",
        nav_contact: "·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ",

        hero_title: "EDUCATION ROBOT KIT",
        hero_subtitle: "·ûÄ·ûò·üí·ûò·ûú·û∑·ûí·û∏·ûî·ûâ·üí·ûá·û∂",

        sec_connect_title: "·ûÄ·û∂·ûö·ûè·ûó·üí·ûá·û∂·ûî·üã üì°",
        sec_connect_desc: "·ûó·üí·ûá·û∂·ûî·üã·ûë·üÖ·ûÄ·û∂·ûì·üã·ûö·üâ·ûº·ûî·ûº·ûè·ûè·û∂·ûò·ûö·ûô·üà Bluetooth ·û¨ Serial·üî",

        btn_connect_bluetooth: "·ûó·üí·ûá·û∂·ûî·üã·ûè·û∂·ûò Bluetooth",
        btn_disconnect_bluetooth: "·ûï·üí·ûè·û∂·ûÖ·üã",

        status_connected: "·ûü·üí·ûê·û∂·ûì·ûó·û∂·ûñ: ·ûî·û∂·ûì·ûó·üí·ûá·û∂·ûî·üã",
        status_disconnected: "·ûü·üí·ûê·û∂·ûì·ûó·û∂·ûñ: ·ûò·û∑·ûì·ûî·û∂·ûì·ûó·üí·ûá·û∂·ûî·üã",

        sec_video_title: "·ûú·û∏·ûä·üÅ·û¢·ûº üé•",
        sec_video_desc: "·ûú·û∏·ûä·üÅ·û¢·ûº·ûî·ûÑ·üí·û†·û∂·ûâ·ûñ·û∏·ûö·üâ·ûº·ûî·ûº·ûè·üî",

        sec_control_title: "·ûß·ûî·ûÄ·ûö·ûé·üç·ûî·ûâ·üí·ûá·û∂ üéÆ",
         sec_connect_title: "·ûó·üí·ûá·û∂·ûî·üã",
         sec_code_title: "·ûÄ·ûº·ûä",
         sec_code_title: "·ûë·üÜ·ûì·û∂·ûÄ·üã·ûë·üÜ·ûì·ûÑ",
    }
};

            // --- 2. Dark/Light Mode Toggle ---
            const currentMode = localStorage.getItem('mode') || 'dark';
            body.className = currentMode + '-mode';
            modeToggle.textContent = currentMode === 'dark' ? '‚òÄÔ∏è' : 'üåô';

            modeToggle.addEventListener('click', () => {
                const newMode = body.classList.contains('light-mode') ? 'dark' : 'light';
                body.className = newMode + '-mode';
                modeToggle.textContent = newMode === 'dark' ? '‚òÄÔ∏è' : 'üåô';
                localStorage.setItem('mode', newMode);
            });

            // --- 3. Localization Functionality ---
            const setLanguage = (lang) => {
                const elements = document.querySelectorAll('[data-i18n]');
                const texts = translations[lang];
                if (!texts) return;

                elements.forEach(el => {
                    const key = el.getAttribute('data-i18n');
                    if (texts[key]) {
                        if (key === 'title') {
                            document.title = texts[key];
                        } 
                        else if (el.tagName !== 'SELECT') { // Exclude the SELECT element itself
                            el.textContent = texts[key];
                        }

                        // Special handling for button text/status text
                        if (el.id === 'connection-state' && connectionState) {
                             // Update the status text based on current connection state
                             const isConnected = el.classList.contains('connected');
                             el.textContent = isConnected ? texts['status_connected'] : texts['status_disconnected'];
                        } else if (el.id === 'connect-bluetooth-btn' && connectBluetoothBtn) {
                            // Ensure button text is set
                            connectBluetoothBtn.textContent = texts['btn_connect_bluetooth'];
                        } else if (el.id === 'disconnect-bluetooth-btn' && disconnectBluetoothBtn) {
                            // Ensure button text is set
                            disconnectBluetoothBtn.textContent = texts['btn_disconnect_bluetooth'];
                        }
                    }
                });
                localStorage.setItem('lang', lang);
            };

            langSwitcher.value = localStorage.getItem('lang') || 'en';
            setLanguage(langSwitcher.value);

            langSwitcher.addEventListener('change', (event) => {
                setLanguage(event.target.value);
            });
            
            // --- Connection Status UI Update Function ---
            const updateConnectionState = (isConnected) => {
                if (!connectionState) return; // Guard for null element
                const lang = langSwitcher.value;
                const texts = translations[lang];

                if (isConnected) {
                    connectionState.classList.remove('disconnected');
                    connectionState.classList.add('connected');
                    connectionState.textContent = texts['status_connected'];
                    if(connectBluetoothBtn) connectBluetoothBtn.disabled = true;
                    if(disconnectBluetoothBtn) disconnectBluetoothBtn.disabled = false;
                } else {
                    connectionState.classList.remove('connected');
                    connectionState.classList.add('disconnected');
                    connectionState.textContent = texts['status_disconnected'];
                    if(connectBluetoothBtn) connectBluetoothBtn.disabled = false;
                    if(disconnectBluetoothBtn) disconnectBluetoothBtn.disabled = true;
                }
            };


            // --- 4. Web Bluetooth Connection Logic (Mock/Placeholder) ---
            let bluetoothDevice = null;
            let controlCharacteristic = null; // GATT characteristic for sending commands

            // MOCK/PLACEHOLDER: Replace with actual Web Bluetooth API logic
            const connectBluetooth = async () => {
                 console.log('Attempting to connect via Web Bluetooth...');
                 updateConnectionState(true); // Mock successful connection
            };

            const disconnectBluetooth = () => {
                console.log('Disconnecting from Bluetooth...');
                updateConnectionState(false); // Mock disconnection
            };
            
            if (connectBluetoothBtn) connectBluetoothBtn.addEventListener('click', connectBluetooth);
            if (disconnectBluetoothBtn) disconnectBluetoothBtn.addEventListener('click', disconnectBluetooth);
            
            // Initial state setup
            updateConnectionState(false); 


            // --- 5. D-Pad Control Logic (Continuous command placeholder) ---
            const dpadButtons = document.querySelectorAll('.dpad-button');
            
            const sendCommand = (commandKey) => {
                // This original logic seems to be for a different D-pad. 
                // We'll keep the new controller's logic below for the integrated buttons.
                console.log(`Sending command: ${commandKey}`);
            }
            
            // This is the old D-Pad logic from the original index.html file. 
            // It is kept for completeness but is likely not needed now.
            /*
            dpadButtons.forEach(button => {
                // Use mousedown and touchstart for continuous action
                button.addEventListener('mousedown', (e) => {
                    const commandKey = button.getAttribute('data-command');
                    sendCommand(commandKey);
                });
                
                button.addEventListener('touchstart', (e) => {
                    e.preventDefault(); // Prevent mobile scrolling/default action
                    const commandKey = button.getAttribute('data-command');
                    sendCommand(commandKey);
                });

                // Use mouseup, mouseleave, and touchend for sending a 'STOP' command
                const stopEvent = () => {
                     sendCommand('CMD_STOP'); // Placeholder stop command
                };

                button.addEventListener('mouseup', stopEvent);
                button.addEventListener('mouseleave', stopEvent);
                button.addEventListener('touchend', stopEvent);
            });
            */
        });

        // --- Controller Script Content (from the second file) ---

        // Global state for tracking the engine status (optional, but good practice)
        let isEngineRunning = false;

        /**
         * Updates the status display on the screen.
         * @param {string} message - The command message to display.
         * @param {string} color - Tailwind color class for the text.
         */
        function updateStatus(message, color = 'text-green-400') {
            const statusElement = document.getElementById('command-status');
            if (!statusElement) return;

            statusElement.textContent = message;
            // Clear previous color classes
            // We use standard CSS classes now, so clear based on common text color prefixes
            statusElement.className = statusElement.className.split(' ').filter(cls => !cls.startsWith('text-')).join(' ');
            // Add new color class (using Tailwind classes included via the script tag)
            statusElement.classList.add(color);
        }

        /**
         * Simulates sending a movement command.
         * @param {string} direction - 'forward', 'backward', 'left', or 'right'.
         */
        function handleMoveCommand(direction) {
            if (!isEngineRunning && direction !== 'stop') {
                updateStatus('Engine is OFF. Press START first!', 'text-yellow-400');
                return;
            }

            let message;
            // let command_url; // In a real app, this would be the URL to the IoT device

            switch (direction) {
                case 'forward':
                    message = 'MOVING FORWARD';
                    // command_url = '/api/move?dir=forward';
                    break;
                case 'backward':
                    message = 'MOVING BACKWARD';
                    // command_url = '/api/move?dir=backward';
                    break;
                case 'left':
                    message = 'TURNING LEFT';
                    // command_url = '/api/move?dir=left';
                    break;
                case 'right':
                    message = 'TURNING RIGHT';
                    // command_url = '/api/move?dir=right';
                    break;
                default:
                    message = 'Invalid Movement Command';
                    return;
            }

            updateStatus(message, 'text-blue-400');
            // console.log(`[API Call] Sending: ${command_url}`); // Uncomment for real use
        }

        /**
         * Simulates sending the START or STOP command.
         * @param {string} action - 'start' or 'stop'.
         */
        function handleEngineAction(action) {
            if (action === 'start') {
                if (!isEngineRunning) {
                    isEngineRunning = true;
                    updateStatus('ENGINE STARTED! Ready to drive.', 'text-green-400');
                    // console.log('[API Call] Sending: /api/engine?action=start');
                } else {
                    updateStatus('Engine is already running.', 'text-green-500');
                }
            } else if (action === 'stop') {
                if (isEngineRunning) {
                    isEngineRunning = false;
                    updateStatus('ENGINE STOPPED.', 'text-red-400');
                    // console.log('[API Call] Sending: /api/engine?action=stop');
                } else {
                    updateStatus('Engine is already stopped.', 'text-red-500');
                }
            }
        }


        // --- Event Handlers (Controller) ---

        // 1. On-Screen Button Listeners
        function setupButtonListeners() {
            document.querySelectorAll('[data-command]').forEach(button => {
                button.addEventListener('click', () => {
                    handleMoveCommand(button.dataset.command);
                });
            });

            const startBtn = document.getElementById('btn-start');
            const stopBtn = document.getElementById('btn-stop');

            if (startBtn) startBtn.addEventListener('click', () => {
                handleEngineAction('start');
            });
            if (stopBtn) stopBtn.addEventListener('click', () => {
                handleEngineAction('stop');
            });
        }

        // 2. Keyboard Listeners (W, A, S, D)
        const keyMap = {
            'w': 'forward',
            's': 'backward',
            'a': 'left',
            'd': 'right',
            'W': 'forward',
            'S': 'backward',
            'A': 'left',
            'D': 'right',
            // Also map arrow keys for convenience
            'ArrowUp': 'forward',
            'ArrowDown': 'backward',
            'ArrowLeft': 'left',
            'ArrowRight': 'right',
            'Enter': 'start', // Start with Enter
            'Escape': 'stop'  // Stop with Escape
        };

        let activeKey = null; // To prevent rapid-fire repeated commands on hold

        window.addEventListener('keydown', (event) => {
            const command = keyMap[event.key];

            if (command && command !== activeKey) {
                event.preventDefault(); // Prevent default browser action (like scrolling)
                activeKey = command;

                if (command === 'start') {
                    handleEngineAction('start');
                } else if (command === 'stop') {
                    handleEngineAction('stop');
                } else {
                    // Check if a move button exists and visually highlight it
                    const button = document.getElementById(`btn-${command}`);
                    if (button) {
                        // Using the :active pseudo-class in CSS is better for click/touch,
                        // but for keyboard, we manually add classes simulating the pressed state
                        button.classList.add('scale-95'); // Tailwind class for scale
                        button.style.boxShadow = 'none'; // Clear box shadow on press
                    }
                    handleMoveCommand(command);
                }
            }
        });

        window.addEventListener('keyup', (event) => {
            const command = keyMap[event.key];

            if (command) {
                // Clear active key only if it was the one released
                if (command === activeKey) {
                    activeKey = null;
                }
                 // Remove visual highlight from move buttons
                const button = document.getElementById(`btn-${command}`);
                if (button) {
                    button.classList.remove('scale-95');
                    button.style.boxShadow = ''; // Restore box shadow
                }
            }
        });

        // --- Initialization ---
        window.onload = function() {
            setupButtonListeners();
            updateStatus('Press START or W/A/S/D to drive!', 'text-gray-300');
        };
        // --- AUTO-MODE BUTTONS FUNCTIONALITY ---
function enableFollowObjectMode() {
    if (!isEngineRunning) {
        updateStatus('Engine is OFF. Press START first!', 'text-yellow-400');
        return;
    }

    updateStatus('AUTO MODE: FOLLOW OBJECT ü§ñ', 'text-purple-400');

    // Send command to robot
    sendCommand('AUTO_FOLLOW'); // Replace 'AUTO_FOLLOW' with the actual command your Arduino expects
    console.log('Command sent: AUTO_FOLLOW');
}

function enableObstacleAvoidMode() {
    if (!isEngineRunning) {
        updateStatus('Engine is OFF. Press START first!', 'text-yellow-400');
        return;
    }

    updateStatus('AUTO MODE: OBSTACLE AVOIDANCE üöß', 'text-yellow-400');

    // Send command to robot
    sendCommand('AUTO_AVOID'); // Replace 'AUTO_AVOID' with the actual command your Arduino expects
    console.log('Command sent: AUTO_AVOID');
}

// Optional: Visual feedback for AUTO-MODE buttons
const autoButtons = document.querySelectorAll('.auto-mode-controller button');
autoButtons.forEach(btn => {
    btn.addEventListener('click', () => {
        autoButtons.forEach(b => b.classList.remove('ring-4', 'ring-offset-2', 'ring-purple-300', 'ring-yellow-300'));
        if (btn.id === 'btn-follow') btn.classList.add('ring-4', 'ring-offset-2', 'ring-purple-300');
        if (btn.id === 'btn-avoid') btn.classList.add('ring-4', 'ring-offset-2', 'ring-yellow-300');
    });
});

    </script>
</body>
</html>
